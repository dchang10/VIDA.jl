<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Interface · VIDA.jl</title><link rel="canonical" href="https://ptiede.github.io/VIDA.jl/interface/"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">VIDA.jl</span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../getting_started/">Getting Started</a></li><li class="is-active"><a class="tocitem" href>Interface</a><ul class="internal"><li><a class="tocitem" href="#Image-type:-EHTImage"><span>Image type: <code>EHTImage</code></span></a></li><li><a class="tocitem" href="#Template-type-AbstractTemplate"><span>Template type <code>AbstractTemplate</code></span></a></li><li><a class="tocitem" href="#Divergence-AbstractDivergence"><span>Divergence <code>AbstractDivergence</code></span></a></li><li><a class="tocitem" href="#Extract-features-extractor-and-ExtractProblem-and-Optimizer"><span>Extract features <code>extractor</code> and <code>ExtractProblem</code> and <code>Optimizer</code></span></a></li></ul></li><li><a class="tocitem" href="../generated/introduction/">Introduction to VIDA</a></li><li><a class="tocitem" href="../generated/custom_template/">Adding a Custom Template</a></li><li><a class="tocitem" href="../api/function_index/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Interface</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Interface</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/ptiede/VIDA.jl/blob/master/docs/src/interface.md#L" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Interface"><a class="docs-heading-anchor" href="#Interface">Interface</a><a id="Interface-1"></a><a class="docs-heading-anchor-permalink" href="#Interface" title="Permalink"></a></h1><p>The interface is based off of using probability divergences to extract features from images. The main functions a user needs to be aware of are:</p><pre><code class="language-julia">#load the image
image = load_fits(file::String)
#create the divergence we want (Bhattacharyya divergence)
bh = Bhattacharyya(image)
#Create the template we want to use to extract for example an slashed elliptical Gaussian
template = GeneralGaussianRing(p::Array) &lt;: AbstractTemplate
#To extract the features we define the ExtractProblem and run extractor
prob = ExtractProblem(divergence, template::T, template_lower::T, template_upper::T) where {T&lt;:AbstractTemplate}
opt_template, divmin = extractor(prob, opt::Optimizer)</code></pre><p>Let&#39;s dive into what each piece means</p><h2 id="Image-type:-EHTImage"><a class="docs-heading-anchor" href="#Image-type:-EHTImage">Image type: <code>EHTImage</code></a><a id="Image-type:-EHTImage-1"></a><a class="docs-heading-anchor-permalink" href="#Image-type:-EHTImage" title="Permalink"></a></h2><ul><li>This is the image you want to fit. Currently we only have support for fits images that are similar to the fits image objects created by <a href="https://github.com/achael/eht-imaging">ehtim</a>. These images are loaded with the function</li></ul><pre><code class="language-julia">  #load fits image
  image = load_fits(&quot;fitsname.fits&quot;)</code></pre><ul><li>There are an additional number of tools available for image processing, such as clipping flux and rescaling the image. For a list of such functions please refer to the <a href="../api/function_index/#API">API</a> page.</li></ul><h2 id="Template-type-AbstractTemplate"><a class="docs-heading-anchor" href="#Template-type-AbstractTemplate">Template type <code>AbstractTemplate</code></a><a id="Template-type-AbstractTemplate-1"></a><a class="docs-heading-anchor-permalink" href="#Template-type-AbstractTemplate" title="Permalink"></a></h2><ul><li>This is the template that will be used to extract an image feature. Basically it will find the template that is the closest to. Currently there are 4 types of templates implemented, but each are a subset of the other:</li></ul><pre><code class="language-julia">    GaussianRing(p) #Gaussian circular ring
    SlashedGaussianRing(p) #Gaussian circular ring with flux asymmetry
    EllipticalGaussianRing(p) #Gaussian elliptical ring
    TIDAGaussianRing(p)  #Gaussian elliptical ring with flux asymmetry where the orientations relative to each other are fixed
    GeneralGaussianRing(p) #Gaussian elliptical slashed ring where orientation of the slash and asymmetry are independent.</code></pre><ul><li>For the parameters that it takes please use the julia ? mode.</li></ul><p>The plotting is done through the recipes macros in Plots.jl. So it should just work! In addition to the plot function there is a new recipe called <code>triptic(img,θ)</code> that will produce a comparison between the template and the true image. This can be useful when comparing the best template to the image.</p><p>Additionally any other function that dispatches on the template type should just work! One thing to note is that the weight between the two templates is relative. Namely, total intensity will always be normalized, so the above code says that θ2 has 5 times the relative flux compared to the first.</p><h2 id="Divergence-AbstractDivergence"><a class="docs-heading-anchor" href="#Divergence-AbstractDivergence">Divergence <code>AbstractDivergence</code></a><a id="Divergence-AbstractDivergence-1"></a><a class="docs-heading-anchor-permalink" href="#Divergence-AbstractDivergence" title="Permalink"></a></h2><p>In order to extract a feature you need to create a probability divergence function. Currently the divergences are defined using a AbstractDivergence type. Currently we have two divergences implemented <a href="https://en.wikipedia.org/wiki/Bhattacharyya_distance">Bhattacharyya divergence (Bh)</a> and the <a href="https://en.wikipedia.org/wiki/Kullback%E2%80%93Leibler_divergence">Kullback-Leibler divergence (KL)</a>. In order to construct the divergence we first need to specify the <code>image</code> that we are trying to fit.</p><pre><code class="language-julia">bh = Bhattacharyya(image) #make the Bh divergence
kl = KullbackLeibler(image) #makes the KL divergence</code></pre><p>which creates a functor that depends on the image. The functor itself take a template, e.g.,</p><pre><code class="language-julia">bh(θ::AbstractTemplate)</code></pre><p>and <code>bh</code> will use multiple dispatch to figure out which template function to use.</p><h2 id="Extract-features-extractor-and-ExtractProblem-and-Optimizer"><a class="docs-heading-anchor" href="#Extract-features-extractor-and-ExtractProblem-and-Optimizer">Extract features <code>extractor</code> and <code>ExtractProblem</code> and <code>Optimizer</code></a><a id="Extract-features-extractor-and-ExtractProblem-and-Optimizer-1"></a><a class="docs-heading-anchor-permalink" href="#Extract-features-extractor-and-ExtractProblem-and-Optimizer" title="Permalink"></a></h2><p>We then use the extractor function to extract the image feature. To call extractor you need to define a <code>ExtractProblem</code> type with the call</p><pre><code class="language-julia">prob = ExtractProblem(divergence, template, template_lower, template_upper)</code></pre><p>where <code>divergence</code> is your probability divergence, <code>template</code> is the template function and <code>template_lower</code> and <code>template_upper</code> are the templates that represent the lower and upper bounds you want to search over. Once you have your problem defined you can find the optimal template and extract image features using the <code>extractor</code> function</p><pre><code class="language-julia">opt_template, divmin = extractor(prob, BBO())</code></pre><p>Here <code>BBO()</code> used the <a href="https://github.com/robertfeldt/BlackBoxOptim.jl">BlackBoxOptim.jl</a> package to optimize. Currently, I have 3 packages that are incorporated with VIDA</p><ul><li><code>BBO()</code>, <a href="https://github.com/robertfeldt/BlackBoxOptim.jl">BlackBoxOptim.jl</a> which uses genetic and evolutionary algorithms to find global maximum.</li><li><code>CMAES()</code>, <a href="https://github.com/jbrea/CMAEvolutionStrategy.jl">CMAESEvolutionStrategy.jl</a> which uses the CMA-ES genetic algorithm to find the global maximum.</li><li><code>Opt()</code>,  <a href="https://github.com/JuliaNLSolvers/Optim.jl">Optim.jl</a>, which allows you to use and box-constrained optimizer from the Optim.jl package, e.g. SAMIN().</li></ul><p>In the future I may add interfaces. In terms of which optimizer to select I would suggest to use BBO() as your default, maybe with the <code>maxevals</code> increased from the default <code>25_000</code>. For other options you can see the documentation and help.</p><p>Note there is a threaded version of the extractor <code>threaded_extractor(nstart, prob, BBO())</code> that run <code>nstart</code> runs of extractor, with different initial conditions randomly sampled in the box-constraints.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../getting_started/">« Getting Started</a><a class="docs-footer-nextpage" href="../generated/introduction/">Introduction to VIDA »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Monday 5 July 2021 16:26">Monday 5 July 2021</span>. Using Julia version 1.6.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
